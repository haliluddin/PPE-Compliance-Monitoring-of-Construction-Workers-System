SOFTWARE DEVELOPMENT DOCUMENTATION

IMPORTANT!
- ALWAYS CHECK IF YOU'RE IN (ppe-env) PS C:\ ... >
- TO GGO THERE RUN "conda activate ppe-env"

1.) Create Python environment

Download:
- python 3.13
- miniconda

Run:
conda create -n ppe-env python=3.8 -y
conda activate ppe-env

Encountered errors:

1. The term 'conda' is not recognized
- Open an Anaconda Prompt
- Run "conda init powershell"
- Close and reopen IDE
- Run again:
conda create -n ppe-env python=3.8 -y
conda activate ppe-env

2. Cannot be loaded because running scripts is disabled on this 
system
- Open Windows PowerShell “as Administrator”
- Run "Set-ExecutionPolicy -Scope CurrentUser RemoteSigned -Force"
- Close and reopen IDE
- Run again:
conda create -n ppe-env python=3.8 -y
conda activate ppe-env

3. CondaToSNonInteractiveError: Terms of Service have not been accepted for the following channels.
- Run:
conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/main
conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/r
conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/msys2
- Run again:
conda create -n ppe-env python=3.8 -y
conda activate ppe-env

Output: (ppe-env) PS C:\ ... >



2.) Install core dependencies

- Run: 

pip install ultralytics
pip install tensorflow==2.10
pip install tf_slim
pip install pillow lxml Cython contextlib2
pip install albumentations
pip install mediapipe
pip install roboflow --no-deps
pip install kaggle opencv-python tqdm matplotlib


---

git clone https://github.com/tensorflow/models
pip install -e models/research/

Encountered errors:

1. ... does not appear to be a Python project: neither 'setup.py' nor 'pyproject.toml' found
- Open: https://github.com/protocolbuffers/protobuf/releases/tag/v3.19.6
- Click: protoc-3.19.6-win64.zip
- Extract all and destination: C:\tools\protoc-3.19.6\
- Press Win + R > type sysdm.cpl > Enter > System Properties > Advanced tab > Environment Variables > select Path > Edit > New > paste "C:\tools\protoc-3.19.6\bin" > OK > OK > OK
- Open Windows PowerShell “as Administrator” and run "protoc --version"
- Close and reopen IDE
- Run:
cd .\models\research
protoc object_detection\protos\*.proto --python_out=.
copy .\object_detection\packages\tf2\setup.py .\
pip install -e .
cd ..\..
python -c "from object_detection.builders import model_builder; print(model_builder)"

Output: <module 'object_detection.builders.model_builder' from '…\models\research\object_detection\builders\model_builder.py'>



3.) Data Acquisition & Organization

KAGGLE (to use Kaggle command)
- Go to https://www.kaggle.com/ > Log in > Profile > Settings > scroll to API > click Create New API Token (this downloads a file called kaggle.json)
- Open Windows PowerShell “as Administrator”
- Run:
mkdir $env:USERPROFILE\.kaggle
move .\Downloads\kaggle.json $env:USERPROFILE\.kaggle\kaggle.json
icacls "$Env:USERPROFILE\.kaggle\kaggle.json" /inheritance:r /grant:r "$($Env:USERNAME):(R)"

---

- Download dataset > extract all in data/raw

Folder structure output (A MUST!!!) :

project/
└── data/
    ├── raw/
    │   ├── helmet-vest and boots detection.v8i.yolov8/     <-- name of dataset (from extracted zip)
    │       ├── images/             						 <-- combine all images in one folder (typically from train/val/test)
    │       └── labels/             					     <-- combine all labels in one folder (typically from train/val/test)
    │
    ├── processed/							<-- will be populated if you run scripts/ingest.py (first)
    │   ├── all_images/       
    │   ├── all_labels/      
    │   └── splits/
    │       ├── train.txt
    │       ├── val.txt
    │       └── test.txt
    │
    ├── augmented/							<-- will be populated if you run scripts/preprocess.py (second)
        ├── images/
        └── labels/
    


4.) Training first model: YOLOv8

- Create data.yaml in scripts folder, inside:

train: ../data/augmented/images
val:   ../data/augmented/images
nc:    4  
names: ['helmet','vest','gloves','boots']

- Run:

yolo task=detect mode=train `
     model=yolov8n.pt `
     data=scripts/data.yaml `
     epochs=50 `
     imgsz=416 `
     batch=16 `
     name=ppe_yolov8n_run1 `
     device=0					<-- change to "device=cpu" if device not NVIDIA


Encountered errors:
1. If device is NVIDIA but yolov8 cant recognized
- Open Windows PowerShell “as Administrator” and run "nvidia-smi" to check
- Close and reopen IDE
- Run:

pip uninstall torch torchvision torchaudio
pip cache purge
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu117

import torch
print(torch.cuda.is_available(), torch.cuda.device_count(), torch.cuda.get_device_name(0))

Output: True 1 NVIDIA GeForce GTX 1650 Ti (for example)

Run again:

yolo task=detect mode=train `
     model=yolov8n.pt `
     data=scripts/data.yaml `
     epochs=50 `
     imgsz=416 `
     batch=16 `
     name=ppe_yolov8n_run1 `
     device=0





----- TRAINING -----



To train (yolov8):

yolo task=segment mode=train model=yolov8n-seg.pt data=data.yaml epochs=50 imgsz=416 batch=16 name=ppe_yolov8n_seg_run1 device=0



For validation and test (yolov8):

$ckpt = "runs/segment/ppe_yolov8n_seg_run1/weights/best.pt"
yolo val data=data.yaml model=$ckpt device=0 save_json=True plots=True
yolo val data=data.yaml model=$ckpt split=test device=0 save_json=True plots=True



To train (Mask rcnn):

python "models\research\object_detection\model_main_tf2.py" `
  --pipeline_config_path="scripts\mask_rcnn.config" `
  --model_dir="models\mask_rcnn_experiments\run1" `
  --alsologtostderr



To remove DOM whenever there's changes in config (Mask rcnn):

$path = 'scripts\mask_rcnn.config'
$bytes = [System.IO.File]::ReadAllBytes($path)

if ($bytes.Length -ge 3 -and $bytes[0] -eq 0xEF -and $bytes[1] -eq 0xBB -and $bytes[2] -eq 0xBF) {
    $new = $bytes[3..($bytes.Length - 1)]
    [System.IO.File]::WriteAllBytes($path, $new)
    "Removed UTF-8 BOM from $path"
} else {
    "No UTF-8 BOM detected; file left unchanged"
}



To train (Efficientdet):

python train_timm_maskrcnn.py --train-json "data/new/train/_annotations.coco.json" --val-json "data/new/valid/_annotations.coco.json" --train-images "data/new/train/" --val-images "data/new/valid/" --num-classes 6 --output-dir "./output_timm_b3" --model-name "tf_efficientnet_b3_ns"  



To evaluate (Efficientdet):

python train_timm_maskrcnn.py --train-json "data/new/train/_annotations.coco.json" --val-json "data/new/valid/_annotations.coco.json" --train-images "data/new/train/" --val-images "data/new/valid/" --num-classes 6 --output-dir "./output_timm_b3" --model-name "tf_efficientnet_b3_ns" --eval-only



To visualize evaluation (Efficientdet):

python visualize_preds.py --weights "./output_timm_b3/model_final.pth" --val-json "data/new/valid/_annotations.coco.json" --val-images "data/new/valid/" --output-dir "./output_viz"



To resume (yolov8) training:

yolo task=segment mode=train model=runs/segment/ppe_yolov8n_seg_run12/weights/last.pt data=data.yaml epochs=50 imgsz=416 batch=16 name=ppe_yolov8n_seg_run12 device=0 --resume





